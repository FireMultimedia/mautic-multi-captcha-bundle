# NGINX CORS Configuration for MauticMultiCaptchaBundle
# Add this to your Mautic server block

# CORS headers for MauticMultiCaptchaBundle assets
location ~* ^/plugins/MauticMultiCaptchaBundle/Assets/.*\.js$ {
    add_header Access-Control-Allow-Origin "*" always;
    add_header Access-Control-Allow-Methods "GET, OPTIONS" always;
    add_header Access-Control-Allow-Headers "Content-Type, X-Requested-With" always;
    
    # Handle preflight requests
    if ($request_method = 'OPTIONS') {
        add_header Access-Control-Allow-Origin "*";
        add_header Access-Control-Allow-Methods "GET, OPTIONS";
        add_header Access-Control-Allow-Headers "Content-Type, X-Requested-With";
        add_header Content-Length 0;
        add_header Content-Type text/plain;
        return 204;
    }
}

# CORS headers for ALTCHA API challenge endpoint
location ~* ^/altcha/api/challenge$ {
    add_header Access-Control-Allow-Origin "*" always;
    add_header Access-Control-Allow-Methods "GET, OPTIONS" always;
    add_header Access-Control-Allow-Headers "Content-Type, X-Requested-With, X-Altcha-Spam-Filter" always;
    
    # Handle preflight requests
    if ($request_method = 'OPTIONS') {
        add_header Access-Control-Allow-Origin "*";
        add_header Access-Control-Allow-Methods "GET, OPTIONS";
        add_header Access-Control-Allow-Headers "Content-Type, X-Requested-With, X-Altcha-Spam-Filter";
        add_header Content-Length 0;
        add_header Content-Type text/plain;
        return 204;
    }
    
    try_files $uri $uri/ /index.php?$query_string;
}